<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›æ˜¾åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-btn:hover {
            background: #3367d6;
        }
        .log {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <h1>H5éšæ‰‹æ‹ - å›æ˜¾åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>ğŸ” DOMå…ƒç´ æ£€æŸ¥</h3>
        <button class="test-btn" onclick="checkDOMElements()">æ£€æŸ¥DOMå…ƒç´ </button>
        <div id="dom-status"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ“± è®¾å¤‡å…¼å®¹æ€§æ£€æŸ¥</h3>
        <button class="test-btn" onclick="checkDeviceCompatibility()">æ£€æŸ¥è®¾å¤‡å…¼å®¹æ€§</button>
        <div id="device-status"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ–¼ï¸ å›¾ç‰‡å›æ˜¾æµ‹è¯•</h3>
        <button class="test-btn" onclick="testImagePreview()">æµ‹è¯•å›¾ç‰‡å›æ˜¾</button>
        <button class="test-btn" onclick="clearImages()">æ¸…é™¤å›¾ç‰‡</button>
        <div id="image-status"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ¬ è§†é¢‘å›æ˜¾æµ‹è¯•</h3>
        <button class="test-btn" onclick="testVideoPreview()">æµ‹è¯•è§†é¢‘å›æ˜¾</button>
        <button class="test-btn" onclick="clearVideos()">æ¸…é™¤è§†é¢‘</button>
        <div id="video-status"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ”— è·³è½¬åˆ°ä¸»åº”ç”¨</h3>
        <button class="test-btn" onclick="goToMainApp()">æ‰“å¼€ä¸»åº”ç”¨</button>
        <p>åœ¨ä¸»åº”ç”¨ä¸­æµ‹è¯•å®é™…çš„æ–‡ä»¶ä¸Šä¼ å’Œå›æ˜¾åŠŸèƒ½</p>
    </div>

    <div class="test-section">
        <h3>ğŸ“‹ æµ‹è¯•æ—¥å¿—</h3>
        <button class="test-btn" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        <div id="test-log" class="log"></div>
    </div>

    <script>
        // æµ‹è¯•æ—¥å¿—åŠŸèƒ½
        function log(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logDiv.textContent += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
            
            console.log(`[TEST] ${message}`);
        }

        function clearLog() {
            document.getElementById('test-log').textContent = '';
        }

        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // æ£€æŸ¥DOMå…ƒç´ 
        function checkDOMElements() {
            log('å¼€å§‹æ£€æŸ¥DOMå…ƒç´ ...');
            
            const elements = [
                'image-placeholder',
                'video-placeholder',
                'image-input-gallery',
                'image-input-camera',
                'video-input-gallery',
                'video-input-camera'
            ];
            
            let allFound = true;
            let results = [];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    results.push(`âœ… ${id}: æ‰¾åˆ°`);
                    log(`DOMå…ƒç´  ${id}: æ‰¾åˆ°`);
                } else {
                    results.push(`âŒ ${id}: æœªæ‰¾åˆ°`);
                    log(`DOMå…ƒç´  ${id}: æœªæ‰¾åˆ°`, 'error');
                    allFound = false;
                }
            });
            
            const status = allFound ? 'success' : 'error';
            const message = allFound ? 
                'æ‰€æœ‰DOMå…ƒç´ éƒ½å·²æ‰¾åˆ°ï¼' : 
                'éƒ¨åˆ†DOMå…ƒç´ æœªæ‰¾åˆ°ï¼Œè¯·æ£€æŸ¥HTMLç»“æ„ã€‚';
            
            showStatus('dom-status', `
                <strong>${message}</strong><br>
                ${results.join('<br>')}
            `, status);
        }

        // æ£€æŸ¥è®¾å¤‡å…¼å®¹æ€§
        function checkDeviceCompatibility() {
            log('å¼€å§‹æ£€æŸ¥è®¾å¤‡å…¼å®¹æ€§...');
            
            const checks = {
                'File API': !!(window.File && window.FileReader && window.FileList && window.Blob),
                'URL.createObjectURL': !!window.URL && !!window.URL.createObjectURL,
                'MediaDevices': !!navigator.mediaDevices,
                'getUserMedia': !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia),
                'ç§»åŠ¨è®¾å¤‡': /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
                'è£è€€è®¾å¤‡': /honor/i.test(navigator.userAgent),
                'åä¸ºè®¾å¤‡': /huawei/i.test(navigator.userAgent)
            };
            
            let results = [];
            let allSupported = true;
            
            Object.entries(checks).forEach(([name, supported]) => {
                const icon = supported ? 'âœ…' : 'âŒ';
                results.push(`${icon} ${name}: ${supported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`);
                log(`${name}: ${supported ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`);
                if (!supported && ['File API', 'URL.createObjectURL'].includes(name)) {
                    allSupported = false;
                }
            });
            
            const status = allSupported ? 'success' : 'warning';
            const message = allSupported ? 
                'è®¾å¤‡å…¼å®¹æ€§è‰¯å¥½ï¼' : 
                'éƒ¨åˆ†åŠŸèƒ½å¯èƒ½ä¸æ”¯æŒï¼Œä½†åŸºæœ¬åŠŸèƒ½åº”è¯¥å¯ç”¨ã€‚';
            
            showStatus('device-status', `
                <strong>${message}</strong><br>
                <strong>ç”¨æˆ·ä»£ç†:</strong> ${navigator.userAgent}<br><br>
                ${results.join('<br>')}
            `, status);
        }

        // æµ‹è¯•å›¾ç‰‡å›æ˜¾
        function testImagePreview() {
            log('å¼€å§‹æµ‹è¯•å›¾ç‰‡å›æ˜¾...');
            
            try {
                // åˆ›å»ºæµ‹è¯•å›¾ç‰‡æ–‡ä»¶
                const canvas = document.createElement('canvas');
                canvas.width = 100;
                canvas.height = 100;
                const ctx = canvas.getContext('2d');
                
                // ç»˜åˆ¶æµ‹è¯•å›¾ç‰‡
                ctx.fillStyle = '#4285f4';
                ctx.fillRect(0, 0, 100, 100);
                ctx.fillStyle = 'white';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('TEST', 50, 55);
                
                canvas.toBlob(blob => {
                    const testFile = new File([blob], 'test-image.png', { type: 'image/png' });
                    log(`åˆ›å»ºæµ‹è¯•å›¾ç‰‡æ–‡ä»¶: ${testFile.name}, å¤§å°: ${testFile.size} bytes`);
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰handleFileSelectionå‡½æ•°
                    if (typeof handleFileSelection === 'function') {
                        handleFileSelection([testFile], 'image');
                        showStatus('image-status', 'âœ… å›¾ç‰‡å›æ˜¾æµ‹è¯•å·²æ‰§è¡Œï¼Œè¯·æ£€æŸ¥ä¸»åº”ç”¨é¡µé¢', 'success');
                        log('å›¾ç‰‡å›æ˜¾æµ‹è¯•å®Œæˆ');
                    } else {
                        showStatus('image-status', 'âŒ handleFileSelectionå‡½æ•°æœªæ‰¾åˆ°', 'error');
                        log('handleFileSelectionå‡½æ•°æœªæ‰¾åˆ°', 'error');
                    }
                }, 'image/png');
                
            } catch (error) {
                log(`å›¾ç‰‡å›æ˜¾æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showStatus('image-status', `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•è§†é¢‘å›æ˜¾
        function testVideoPreview() {
            log('å¼€å§‹æµ‹è¯•è§†é¢‘å›æ˜¾...');
            
            try {
                // åˆ›å»ºæµ‹è¯•è§†é¢‘æ–‡ä»¶ï¼ˆæ¨¡æ‹Ÿï¼‰
                const testVideoData = new Uint8Array([
                    0x00, 0x00, 0x00, 0x20, 0x66, 0x74, 0x79, 0x70, 0x69, 0x73, 0x6F, 0x6D,
                    0x00, 0x00, 0x02, 0x00, 0x69, 0x73, 0x6F, 0x6D, 0x69, 0x73, 0x6F, 0x32,
                    0x6D, 0x70, 0x34, 0x31, 0x00, 0x00, 0x00, 0x08, 0x66, 0x72, 0x65, 0x65
                ]);
                
                const testBlob = new Blob([testVideoData], { type: 'video/mp4' });
                const testFile = new File([testBlob], 'test-video.mp4', { type: 'video/mp4' });
                
                log(`åˆ›å»ºæµ‹è¯•è§†é¢‘æ–‡ä»¶: ${testFile.name}, å¤§å°: ${testFile.size} bytes`);
                
                // æ£€æŸ¥æ˜¯å¦æœ‰handleFileSelectionå‡½æ•°
                if (typeof handleFileSelection === 'function') {
                    handleFileSelection([testFile], 'video');
                    showStatus('video-status', 'âœ… è§†é¢‘å›æ˜¾æµ‹è¯•å·²æ‰§è¡Œï¼Œè¯·æ£€æŸ¥ä¸»åº”ç”¨é¡µé¢', 'success');
                    log('è§†é¢‘å›æ˜¾æµ‹è¯•å®Œæˆ');
                } else {
                    showStatus('video-status', 'âŒ handleFileSelectionå‡½æ•°æœªæ‰¾åˆ°', 'error');
                    log('handleFileSelectionå‡½æ•°æœªæ‰¾åˆ°', 'error');
                }
                
            } catch (error) {
                log(`è§†é¢‘å›æ˜¾æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                showStatus('video-status', `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ¸…é™¤å›¾ç‰‡
        function clearImages() {
            if (typeof selectedImages !== 'undefined' && typeof updateImagePreview === 'function') {
                selectedImages.length = 0;
                updateImagePreview();
                updateImageCount();
                log('å·²æ¸…é™¤æ‰€æœ‰å›¾ç‰‡');
                showStatus('image-status', 'âœ… å›¾ç‰‡å·²æ¸…é™¤', 'success');
            } else {
                log('æ— æ³•æ¸…é™¤å›¾ç‰‡ï¼šç›¸å…³å‡½æ•°æœªæ‰¾åˆ°', 'error');
                showStatus('image-status', 'âŒ æ— æ³•æ¸…é™¤ï¼šç›¸å…³å‡½æ•°æœªæ‰¾åˆ°', 'error');
            }
        }

        // æ¸…é™¤è§†é¢‘
        function clearVideos() {
            if (typeof selectedVideos !== 'undefined' && typeof updateVideoPreview === 'function') {
                selectedVideos.length = 0;
                updateVideoPreview();
                updateVideoCount();
                log('å·²æ¸…é™¤æ‰€æœ‰è§†é¢‘');
                showStatus('video-status', 'âœ… è§†é¢‘å·²æ¸…é™¤', 'success');
            } else {
                log('æ— æ³•æ¸…é™¤è§†é¢‘ï¼šç›¸å…³å‡½æ•°æœªæ‰¾åˆ°', 'error');
                showStatus('video-status', 'âŒ æ— æ³•æ¸…é™¤ï¼šç›¸å…³å‡½æ•°æœªæ‰¾åˆ°', 'error');
            }
        }

        // è·³è½¬åˆ°ä¸»åº”ç”¨
        function goToMainApp() {
            window.location.href = 'index.html';
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', function() {
            log('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            
            // å»¶è¿Ÿæ£€æŸ¥ï¼Œç¡®ä¿ä¸»åº”ç”¨çš„è„šæœ¬å·²åŠ è½½
            setTimeout(() => {
                checkDOMElements();
                checkDeviceCompatibility();
            }, 500);
        });
    </script>
</body>
</html>